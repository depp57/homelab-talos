clusterName: homelab
endpoint: https://192.168.1.10:6443
allowSchedulingOnMasters: true
talosVersion: v1.11.0
cniConfig:
  name: none                              # do not deploy a default CNI (flannel), because I use Cilium
inlineManifests:
  - name: argocd
    contents: "@../bootstrap/argocd/manifest.yaml"
    skipEnvsubst: true
  - name: external-secrets
    contents: "@../bootstrap/external-secrets/bitwarden-secret.yaml"
    skipEnvsubst: true
  - name: cilium
    contents: "@../bootstrap/cilium/cilium-install.yaml"
    skipEnvsubst: true
patches:
  - |-                                    # do not deploy kube-proxy, as Cilium replaces it
    cluster:
      proxy:
        disabled: true

nodes:
  - hostname: server1
    controlPlane: true
    ipAddress: 192.168.1.10
    installDisk: /dev/nvme0n1
    machineSpec:
      secureboot: true
    schematic:
      customization:
        systemExtensions:
          officialExtensions:
            - siderolabs/iscsi-tools      # required by longhorn
            - siderolabs/util-linux-tools # required by longhorn
    patches:
      - |-                                # required by longhorn
        - op: add
          path: /machine/kubelet/extraMounts
          value:
            - destination: /var/lib/longhorn
              type: bind
              source: /var/lib/longhorn
              options:
                - bind
                - rshared
                - rw
      - |-
        - op: replace
          path: /machine/install/wipe
          value: true